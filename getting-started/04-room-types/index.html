
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://priw8.github.io/liblevelgen-doc/getting-started/04-room-types/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>Placing things in rooms - LibLevelGen</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Placing things in rooms - LibLevelGen" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://priw8.github.io/liblevelgen-doc/assets/images/social/getting-started/04-room-types.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://priw8.github.io/liblevelgen-doc/getting-started/04-room-types/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Placing things in rooms - LibLevelGen" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://priw8.github.io/liblevelgen-doc/assets/images/social/getting-started/04-room-types.png" >
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#placing-things-in-rooms" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LibLevelGen" class="md-header__button md-logo" aria-label="LibLevelGen" data-md-component="logo">
      
  <img src="../../icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibLevelGen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Placing things in rooms
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://gitlab.com/Priw8/LibLevelGen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitLab
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LibLevelGen" class="md-nav__button md-logo" aria-label="LibLevelGen" data-md-component="logo">
      
  <img src="../../icon.png" alt="logo">

    </a>
    LibLevelGen
  </label>
  
    <div class="md-nav__source">
      <a href="https://gitlab.com/Priw8/LibLevelGen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitLab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome to LibLevelGen
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-basics/" class="md-nav__link">
        The basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-more-rooms/" class="md-nav__link">
        Creating more rooms
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Placing things in rooms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Placing things in rooms
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#room-types" class="md-nav__link">
    Room types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#placing-entities" class="md-nav__link">
    Placing entities!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-levels" class="md-nav__link">
    Entity levels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#placing-torches" class="md-nav__link">
    Placing torches
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-an-exit-room" class="md-nav__link">
    Making an exit room
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Enemy.lua/" class="md-nav__link">
        Enemy.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Entity.lua/" class="md-nav__link">
        Entity.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ErrorLevel.lua/" class="md-nav__link">
        ErrorLevel.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/LibLevelGen.lua/" class="md-nav__link">
        LibLevelGen.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Loot.lua/" class="md-nav__link">
        Loot.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Rand.lua/" class="md-nav__link">
        Rand.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Room.lua/" class="md-nav__link">
        Room.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/SecretRoom.lua/" class="md-nav__link">
        SecretRoom.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/SecretShop.lua/" class="md-nav__link">
        SecretShop.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Segment.lua/" class="md-nav__link">
        Segment.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Settings.lua/" class="md-nav__link">
        Settings.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Shrine.lua/" class="md-nav__link">
        Shrine.lua
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/Util.lua/" class="md-nav__link">
        Util.lua
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#room-types" class="md-nav__link">
    Room types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#placing-entities" class="md-nav__link">
    Placing entities!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-levels" class="md-nav__link">
    Entity levels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#placing-torches" class="md-nav__link">
    Placing torches
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-an-exit-room" class="md-nav__link">
    Making an exit room
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="placing-things-in-rooms">Placing things in rooms<a class="headerlink" href="#placing-things-in-rooms" title="Permanent link">&para;</a></h1>
<p>Now we know how to make more rooms than we probably need, but they're all empty and that's pretty boring. For testing, we'll start with this generator, which is a toned-down version of one from the previous part:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">local</span> <span class="n">libLevelGen</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;LibLevelGen.LibLevelGen&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kd">local</span> <span class="n">segment</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;LibLevelGen.Segment&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kd">local</span> <span class="n">room</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;LibLevelGen.Room&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kd">local</span> <span class="n">roomGenCombinations</span> <span class="o">=</span> <span class="n">segment</span><span class="p">.</span><span class="n">createRandLinkedRoomParameterCombinations</span> <span class="p">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">direction</span> <span class="o">=</span> <span class="p">{</span><span class="n">room</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">UP</span><span class="p">,</span> <span class="n">room</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">room</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">room</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">RIGHT</span><span class="p">},</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">corridorEntrance</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">},</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">corridorExit</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">},</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">corridorThickness</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">corridorLength</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">roomWidth</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">},</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">roomHeight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">},</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">createTwoRooms</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="n">roomsLeft</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="kr">if</span> <span class="n">roomsLeft</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="kd">local</span> <span class="n">newCorridor1</span><span class="p">,</span> <span class="n">newRoom1</span> <span class="o">=</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">segment</span><span class="p">:</span><span class="n">createRandLinkedRoom</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">roomGenCombinations</span><span class="p">)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="kd">local</span> <span class="n">newCorridor2</span><span class="p">,</span> <span class="n">newRoom2</span> <span class="o">=</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">segment</span><span class="p">:</span><span class="n">createRandLinkedRoom</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">roomGenCombinations</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="c1">-- Check if the generation didn&#39;t fail:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        <span class="kr">if</span> <span class="n">newRoom1</span> <span class="kr">then</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>            <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">newRoom1</span><span class="p">,</span> <span class="n">roomsLeft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="kr">end</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="kr">if</span> <span class="n">newRoom2</span> <span class="kr">then</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>            <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">newRoom2</span><span class="p">,</span> <span class="n">roomsLeft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        <span class="kr">end</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="kr">end</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="kr">end</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">myGenerator</span><span class="p">(</span><span class="n">genParams</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="kd">local</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">libLevelGen</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">genParams</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="kd">local</span> <span class="n">mainSegment</span> <span class="o">=</span> <span class="n">instance</span><span class="p">:</span><span class="n">createSegment</span><span class="p">()</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="kd">local</span> <span class="n">startingRoom</span> <span class="o">=</span> <span class="n">mainSegment</span><span class="p">:</span><span class="n">createStartingRoom</span><span class="p">()</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">startingRoom</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="n">instance</span><span class="p">:</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="kr">end</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="n">libLevelGen</span><span class="p">.</span><span class="n">registerGenerator</span><span class="p">(</span><span class="s2">&quot;LibLevelGen Playground&quot;</span><span class="p">,</span> <span class="n">myGenerator</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="room-types">Room types<a class="headerlink" href="#room-types" title="Permanent link">&para;</a></h2>
<p>As mentioned earlier, a "room" in LibLevelGen is a quite wide term - it applies to actual rooms, corridors, secret rooms, vaults and even secret shops! Because of this, we need a way to know which operations we can perform in which room - and this is where <a href="../../modules/Room.lua/#roomflag">room flags</a> come into play.  </p>
<p>If you check out the link above, you'll see that there's a lot of flags like <code>ALLOW_ENEMY</code>, <code>ALLOW_SHRINE</code>, <code>EXIT</code> and more. These determine what kind of things can be done to the room. For example, an exit room will have <code>ALLOW_ENEMY</code> but not <code>ALLOW_SHRINE</code>, because shrines don't spawn in exit rooms.</p>
<p>There's also a second enum, <a href="modules/Room.lua/#roomtype">room types</a>, which are just collections of flag. For example, <code>room.Type.EXIT</code> consists of <code>ALLOW_ENEMY</code>, <code>ALLOW_TRAVELRUNE</code>, <code>ALLOW_TORCH</code>, <code>ALLOW_TILE_CONVERSION</code> and <code>EXIT</code>.  </p>
<p>When creating rooms with <code>createRandLinkedRoom</code>, the corridors get flags set to <code>room.Type.CORRIDOR</code> and the actual rooms to <code>room.Type.REGULAR</code>. Of course, you can then modify the flags to your liking, but these are generally pretty good defaults.</p>
<p>There's a method to select all rooms which match given flags: <code>Segment:selectRooms</code>, though often it might be more convenient to use <code>Segment:iterateRooms</code>, which will automatically call the given function for every matching room.</p>
<h2 id="placing-entities">Placing entities!<a class="headerlink" href="#placing-entities" title="Permanent link">&para;</a></h2>
<p>Let's run some code for every room which allows enemies, like so:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">placeEnemies</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">dbg</span><span class="p">(</span><span class="s2">&quot;Hello from room at &quot;</span><span class="p">,</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="c1">-- room.Flag.inspect is a useful debug method that exists for</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="c1">-- every enum automatically.</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">dbg</span><span class="p">(</span><span class="s2">&quot;My flags are: &quot;</span><span class="p">,</span> <span class="n">room</span><span class="p">.</span><span class="n">Flag</span><span class="p">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">.</span><span class="n">flags</span><span class="p">))</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kr">end</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">myGenerator</span><span class="p">(</span><span class="n">genParams</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="kd">local</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">libLevelGen</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">genParams</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="kd">local</span> <span class="n">mainSegment</span> <span class="o">=</span> <span class="n">instance</span><span class="p">:</span><span class="n">createSegment</span><span class="p">()</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="kd">local</span> <span class="n">startingRoom</span> <span class="o">=</span> <span class="n">mainSegment</span><span class="p">:</span><span class="n">createStartingRoom</span><span class="p">()</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">startingRoom</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">mainSegment</span><span class="p">:</span><span class="n">iterateRooms</span><span class="p">(</span><span class="n">room</span><span class="p">.</span><span class="n">Flag</span><span class="p">.</span><span class="n">ALLOW_ENEMY</span><span class="p">,</span> <span class="n">placeEnemies</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">instance</span><span class="p">:</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="kr">end</span>
</code></pre></div>
With the current generator, this should run <code>placeEnemies</code> for every non-corridor room except the starting room, which is where we definitely do not want any enemies. Now, let's place some entities in the room: this can be done using a handful of methods, but all of them call <code>Tile:placeEntity</code> in the end:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">placeEnemies</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">currentRoom</span><span class="p">:</span><span class="n">getTile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span><span class="n">placeEntity</span><span class="p">(</span><span class="s2">&quot;Skeleton&quot;</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kr">end</span>
</code></pre></div>
This will create a little Skeleton friend in the top-left corner of every room where enemies are allowed. Now, it'd be nicer to place the enemy randomly, and there's actually an entire system for selecting tiles which we'll talk about in the next part. For now, let's just place the skeleton in a corner.  </p>
<p>A quick reminder though: this does not actually create an actual entity <em>yet</em>, it creates a LibLevelGen Entity object which will then be used to construct the data needed to spawn the entity by the game.  </p>
<p>But <code>room:getTile(...):placeEntity(...)</code> is a lot of typing, so there's a convenience method to do this with a few less characters:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">currentRoom</span><span class="p">:</span><span class="n">placeEntityAt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Skeleton&quot;</span><span class="p">)</span>
</code></pre></div>
<em>yes, I am pretty lazy</em></p>
<h2 id="entity-levels">Entity levels<a class="headerlink" href="#entity-levels" title="Permanent link">&para;</a></h2>
<p>So in the base game, different entity levels are defined by just appending a number to the entity name: like <code>Skeleton</code>, <code>Skeleton2</code>, <code>Skeleton3</code> and so on. But LibLevelGen actually handles it a bit differently - the level and the type are separate arguments to <code>placeEntity</code> methods.<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">currentRoom</span><span class="p">:</span><span class="n">placeEntityAt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Skeleton&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">-- Yellow Skeleton</span>
</code></pre></div>
But why do it like that? You see, LibLevelGen is capable of automatically handling Shrine of War upgrades, Ring of Peace downgrades and other things that affect entity levels. Instead of extracting the entity level and type from the name, they are specified separately for convenience. Though spawning a <code>Skeleton3</code> will also work, LibLevelGen will not actually know that it's a Skeleton - it will interpret this as an entity with base type called <code>Skeleton3</code> and level <code>1</code>. We'll talk more about enemy upgrades and registering your own, custom entity types in the future.</p>
<h2 id="placing-torches">Placing torches<a class="headerlink" href="#placing-torches" title="Permanent link">&para;</a></h2>
<p>Our level could really use some more light, so let's add some torches to it. We could iterate over rooms that have the <code>ALLOW_TORCH</code> flag, but there's actually a convenience function to place a given amount of torches per room:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">-- In myGenerator function, after placing the rooms...</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">mainSegment</span><span class="p">:</span><span class="n">placeWallTorches</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
Suddenly it's a lot nicer in here, huh?  </p>
<h2 id="making-an-exit-room">Making an exit room<a class="headerlink" href="#making-an-exit-room" title="Permanent link">&para;</a></h2>
<p>Our level is still missing a pretty crucial part - a way to actually leave it. So first, we need to pick a room that we'll make into an exit room, and ideally it should not be directly adjacent to the exit. We can do that with modyfing the <code>createTwoRooms</code> function in a clever way:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">createExit</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">dbg</span><span class="p">(</span><span class="s2">&quot;Create an exit room here!&quot;</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kr">end</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">createTwoRooms</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="n">roomsLeft</span><span class="p">,</span> <span class="n">needsExit</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="kr">if</span> <span class="n">roomsLeft</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="kd">local</span> <span class="n">newCorridor1</span><span class="p">,</span> <span class="n">newRoom1</span> <span class="o">=</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">segment</span><span class="p">:</span><span class="n">createRandLinkedRoom</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">roomGenCombinations</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>        <span class="kd">local</span> <span class="n">newCorridor2</span><span class="p">,</span> <span class="n">newRoom2</span> <span class="o">=</span> <span class="n">currentRoom</span><span class="p">.</span><span class="n">segment</span><span class="p">:</span><span class="n">createRandLinkedRoom</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">roomGenCombinations</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        <span class="c1">-- Check if the generation didn&#39;t fail:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="kr">if</span> <span class="n">newRoom1</span> <span class="kr">then</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">newRoom1</span><span class="p">,</span> <span class="n">roomsLeft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">needsExit</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="kr">end</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="kr">if</span> <span class="n">newRoom2</span> <span class="kr">then</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>            <span class="n">createTwoRooms</span><span class="p">(</span><span class="n">newRoom2</span><span class="p">,</span> <span class="n">roomsLeft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        <span class="kr">end</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="kr">elseif</span> <span class="n">needsExit</span> <span class="kr">then</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="n">createExit</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="kr">end</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="kr">end</span>
</code></pre></div>
And then we add the extra argument we just added to the initial call:<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">-- in myGenerator function</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">createTwoRooms</span><span class="p">(</span><span class="n">startingRoom</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre></div>
Essentially, the <code>needsExit</code> parameter will only remain true for one of the last rooms generated, so even if we were to change <code>2</code> to <code>5</code> when calling <code>createTwoRooms</code> we'll still get only one exit room. Of course, you can do this in any other way you'd like.</p>
<p>Now, how do we make this room an exit room?
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">local</span> <span class="kr">function</span> <span class="nf">createExit</span><span class="p">(</span><span class="n">currentRoom</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">currentRoom</span><span class="p">:</span><span class="n">makeExit</span> <span class="p">{</span> <span class="p">{</span><span class="s2">&quot;Dragon&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;Minotaur&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span> <span class="p">}</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kr">end</span>
</code></pre></div>
Aaaand that's it, this function will do everything for us. As the <a href="../../modules/Room.lua/#liblevelgenroommakeexit">documentation</a> states:</p>
<blockquote>
<p><em>Turn the room into an exit room - set appropriate flags, place the exit stairs and the miniboss.</em></p>
</blockquote>
<p>We just need to specify which minibosses it can pick from. It even makes sure that the same miniboss type won't appear 2 floors in a row (unless there's no other choice), and also makes sure to spawn 2 minibosses when Shrine of Boss is active. Wowie!</p>
<p>Our level is slowly getting better! In the next part, we'll learn the tile selection system briefly mentioned here.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../03-more-rooms/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Creating more rooms" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Creating more rooms
            </div>
          </div>
        </a>
      
      
        
        <a href="../../modules/Enemy.lua/" class="md-footer__link md-footer__link--next" aria-label="Next: Enemy.lua" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Enemy.lua
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>